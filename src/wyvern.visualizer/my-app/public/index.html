<html>

<head>
  <style>
    body {
      margin: 0;
    }
  </style>

  <script src="http://unpkg.com/force-graph"></script>
  <style type="text/css">
    .graph-tooltip {
      position: absolute;
      transform: translate(-50%, 25px);
      font-family: Sans-serif;
      font-size: 16px;
      padding: 4px;
      border-radius: 3px;
      color: #eee;
      background: rgba(0, 0, 0, 0.65);
      visibility: hidden;
      /* by default */
    }

    .grabbable {
      cursor: move;
      cursor: grab;
      cursor: -moz-grab;
      cursor: -webkit-grab;
    }

    .grabbable:active {
      cursor: grabbing;
      cursor: -moz-grabbing;
      cursor: -webkit-grabbing;
    }
  </style>
  <!--<script src="../../dist/force-graph.js"></script>-->
</head>

<body>
  <div id="graph" style="">
    <div style="position: relative;"><canvas width="3076" height="1898" style="width: 1538px; height: 949px;"
        class=""></canvas>
      <div class="graph-tooltip" style="top: 203px; left: 792px; visibility: hidden;"></div>
    </div>
  </div>

  <script>
    const initial_path = "akka://ClusterSystem";
    const initData = { nodes: [], links: [] };

    const elem = document.getElementById("graph");

    const Graph = ForceGraph()(elem)
      .onNodeHover(node => elem.style.cursor = node ? 'pointer' : null)
      .onNodeClick(removeNode)
      .nodeLabel('name')
      .linkDirectionalParticles(2)
      .graphData(initData);

    function addNode(node, name, linkz) {
      const { nodes, links } = Graph.graphData();
      Graph.graphData({
        nodes: [...nodes, { id: node, name: name }],
        links: [...links, ...linkz]
      });
    };

    function removeNode(node) {
      // let { nodes, links } = Graph.graphData();
      // links = links.filter(l => l.source !== node && l.target !== node); // Remove links attached to node
      // nodes.splice(node.id, 1); // Remove node
      // nodes.forEach((n, idx) => { n.id = idx; }); // Reset node ids to array index
      // Graph.graphData({ nodes, links });
    }

    const crawl = (path, name) => {
      fetch("http://localhost:5000/api/visualizer/list?path=" + path + "/")
        .then(res => res.json())
        .then(json => {
          addNode(
            path,
            name,
            json.Children.map(
              (child) => ({ source: path, target: child.Path })
            )
          )
          json.Children.forEach(x => crawl(x.Path, x.Name));
        });
    };
    crawl(initial_path, '');

  </script>
</body>

</html>
